<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="../../bower_components/lancie-form/lancie-form.html">
<link rel="import" href="../../bower_components/lancie-login-form/lancie-passwords.html">
<link rel="import" href="../lancie-icons.html">

<dom-module id="my-area-password">
    <template>
        <style include="iron-flex iron-flex-alignment"></style>
        <style>
            :host {
      display: block;
    }

    [hidden] {
      display: none !important;
    }

    paper-tooltip {
      --paper-tooltip-background: var(--primary-color);
      --paper-tooltip-text-color: var(--secondary-color);
    }

    paper-icon-button[icon="lancie:clear"] {
      --iron-icon-fill-color: #F44336;
    }

    paper-icon-button[icon="lancie:check"] {
      --iron-icon-fill-color: #4CAF50;
    }

    iron-icon {
      padding: 8px;
      margin-right: 8px;
    }
</style>

        <paper-card class="layout vertical flex" heading="Password">
            <div class="card-content">

                <div class="layout horizontal center" hidden$="[[editing]]">
                    <iron-icon icon="lancie:lock" item-icon></iron-icon>
                    <div class="item flex">
                        <div>&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;</div>
                    </div>
                </div>
                <div class="layout horizontal center" hidden$="[[!editing]]">
                    <iron-icon icon="lancie:lock" item-icon></iron-icon>
                    <lancie-form id="form" class="flex" refurl="users/current/password" on-response="onPasswordUpdate">
                        <paper-input id="oldPasswords" label="Current Password" name="oldPassword" type="password" error="Fill in your password" required></paper-input>
                        <lancie-passwords id="newPassword" name="newPassword"></lancie-passwords>
                    </lancie-form>
                </div>
            </div>

            <div class="card-actions" hidden$="[[editing]]">
                <paper-icon-button id="change-password" icon="lancie:create" on-tap="openForm"></paper-icon-button>
                <paper-tooltip for="change-password" offset="0" animation-delay="1">Change password</paper-tooltip>
            </div>
            <div class="card-actions" hidden$="[[!editing]]">
                <paper-icon-button id="closeIcon" icon="lancie:clear" on-tap="reset"></paper-icon-button>
                <paper-tooltip for="closeIcon" offset="0" animation-delay="1">Cancel</paper-tooltip>
                <paper-icon-button id="checkIcon" icon="lancie:check" on-tap="submit"></paper-icon-button>
                <paper-tooltip for="checkIcon" offset="0" animation-delay="1">Update password</paper-tooltip>
            </div>
        </paper-card>

    </template>
    <script>
        'use strict';

        (function() {
            Polymer({
                is: 'my-area-password',
                properties: {
                    editing: {
                        type: Boolean,
                        value: false,
                    },
                },

                openForm: function() {
                    this.editing = true;
                },

                reset: function() {
                    this.editing = false;
                    this.$.form.reset();
                    this.$.newPassword.reset();
                },

                submit: function() {
                    if (this.$.form.validateAndSubmit()) {
                        this.$.form.reset();
                        this.$.newPassword.reset();
                    }
                },

                onPasswordUpdate: function(e, request) {
                    if (request.succeeded) {
                        this.fire('toast', {
                            text: 'Password updated.',
                        });
                        this.reset();
                    } else {
                        if (request.request.status === 403) {
                            this.fire('toast', {
                                text: 'Incorrect password.',
                            });
                        } else {
                            this.fire('toast', {
                                text: 'Password update failed.',
                            });
                        }
                    }
                },

            });
        })();
    </script>
</dom-module>
