<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../lancie-login/lancie-ajax.html">

<dom-module id="lancie-ticket-item">
  <template>
    <style>
      :host {
        display: block;
        margin: 8px;
        background-color: gray;
      }
    </style>

    <lancie-ajax id="addTicket" method="POST" on-response="onAddTicket"></lancie-ajax>

    <div on-tap="addToBasket">
      [[ticket.text]]
    </div>

  </template>
  <script>
  'use strict';

  (function() {
    Polymer({
      is: 'lancie-ticket-item',
      properties: {
        ticket: Object,
        basket: {
          type: Object,
          notify: true,
        },
        orderid: String,
        member: {
          type: Boolean,
          value: false,
        },
        pickup: {
          type: Boolean,
          value: false,
        }
      },

      addToBasket: function() {
        if (!this.basket.tickets) {
          this.$.addTicket.refurl = "orders"
        } else if (this.basket.tickets.length === 5) {
          // TODO: Toast of max ticket amount
          console.log("Max of 5 tickets;");
          return;
        } else {
          this.$.addTicket.refurl = "orders/" + this.basket.id;
        }
        this.$.addTicket.body = {
          type: this.ticket.ticketType,
          chMember: this.member,
          pickupService: this.pickup
        };

        this.$.addTicket.generateRequest();
      },

      onAddTicket: function(e, request) {
        if (request.succeeded) {
          this.fire("set-basket", {basket: request.response.object});
        } else {
          // todo: implement error handling
          console.log("Error");
        }
      }

    });
  })();
  </script>
</dom-module>
