<!--
@license
Copyright (c) 2015 The LANcie commission of W.I.S.V `Christiaan Huygens`. All rights reserved.
This code may only be used under the BSD style license found at https://github.com/WISVCH/LANcie/blob/master/LICENSE
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../lancie-dialog/lancie-dialog.html">
<link rel="import" href="../lancie-error/lancie-error.html">

<dom-module id="lancie-seat">
  <template>
    <style include="iron-flex iron-flex-alignment iron-flex-factors">
    :host {
      display: block;
      position: relative;
      min-width: 0;
    }

    [hidden] {
      display: none !important;
    }

    .seat {
      height: 100%;
      margin: 4px;
      border-radius: 2px;
      background: #fafafa;
      box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
    }

    .green {
      background-color: #4CAF50;
    }

    .yellow {
      background-color: #FFEB3B;
    }

    .red {
      background-color: #F44336;
    }

    .blue {
      background-color: #42A5F5;
    }
    </style>
    <div id="seat" class$="seat layout center center-justified horizontal flex {{_calculateClass(user, tickets, seat, filter)}}" on-tap="showSeatDialog">
      <div>{{seat.seatNumber}}</div>
      <paper-tooltip for="seat" animationDelay="0">{{_getTooltipText(seat)}}</paper-tooltip>
    </div>
  </template>
  <script>
  'use strict';

  (function() {
    Polymer({
      is: 'lancie-seat',
      behaviors: [
        Polymer.PaperButtonBehavior
      ],
      properties: {
        user: {
          type: Object,
          value: {}
        },
        seat: Object,
        tickets: {
          type: Array,
          value: function() {
            return [];
          }
        },
        filter: {
          type: String,
          value: ''
        }
      },
      showSeatDialog: function() {
        if (this.seat.taken) {
          return;
        }
        console.log(this.seat);
        this.fire('openDialog', this.seat);
      },
      _calculateClass: function(user, teamTickets, seat, filter) {
        if (!seat.taken) {
          return '';
        }
        if (seat.ticket && seat.ticket.owner.profile.displayName && filter !== '' && seat.ticket.owner.profile.displayName.toLowerCase().indexOf(filter.toLowerCase()) > -1) {
          return 'blue';
        }
        if ((seat.taken && this.fixed) || (seat.taken && !seat.ticket)) {
          return 'red';
        }
        if (!this.fixed && user.reference === seat.ticket.owner.reference) {
          return 'yellow';
        }
        var teamMembers = teamTickets.map(function(ticket) {
          return ticket.owner.reference;
        });
        if (!this.fixed && teamMembers.includes(seat.ticket.owner.reference)) {
          return 'green';
        }
        return 'red';
      },
      _getTooltipText: function(seat) {
        if (!seat.taken) {
          return 'Free';
        }
        if (seat.taken && !seat.ticket) {
          return 'Reserved';
        }
        return seat.ticket.owner.profile.displayName;
      }
    });
  })();
  </script>
</dom-module>
