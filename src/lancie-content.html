<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-lazy-pages/iron-lazy-pages.html">
<link rel="import" href="lancie-login/lancie-ajax.html">
<link rel="import" href="lancie-login/lancie-login-check.html">

<link rel="import" href="lancie-contact/lancie-contact.html">
<link rel="import" href="lancie-contact/lancie-contact-success.html">

<dom-module id="lancie-content">
  <template>
    <style>
      :host {
        display: block;
        min-height: calc(100vh - /*Height of footer*/ 272px - /*Height of top bar*/ 64px);
      }
    </style>

    <iron-ajax
      auto
      url="/api/v1/users/current"
      handle-as="json"
      on-response="storeUser"></iron-ajax>

    <lancie-ajax id="ajax"></lancie-ajax>

    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{page}}"></app-route>

    <iron-lazy-pages attr-for-selected="data-route" selected="{{page.page}}" fallback-selection="404">
      <lancie-home-page data-route="" data-path="src/lancie-home-page/lancie-home-page.html"></lancie-home-page>

      <lancie-login-check user="{{user}}" data-route="my-area" data-path="src/lancie-my-area/lancie-my-area.html">
        <lancie-my-area user="{{user}}"></lancie-my-area>
      </lancie-login-check>

      <lancie-login-check user="{{user}}" data-route="accept-transfer" data-path="src/lancie-my-area/lancie-accept-ticket-transfer.html">
        <lancie-accept-ticket-transfer></lancie-accept-ticket-transfer>
      </lancie-login-check>

      <lancie-success-ticket-transfer data-route="transfer-success" data-path="src/lancie-my-area/lancie-success-ticket-transfer.html"></lancie-success-ticket-transfer>

      <lancie-login-check user="{{user}}" data-route="tickets" data-path="src/lancie-ticket-page/lancie-ticket-page.html">
        <lancie-ticket-page route="{{page.page}}" user="{{user}}"></lancie-ticket-page>
      </lancie-login-check>

      <lancie-login-check user="{{user}}" data-route="seatmap" data-path="src/lancie-seatmap/lancie-seatmap.html">
        <lancie-seatmap user="{{user}}"></lancie-seatmap>
      </lancie-login-check>

      <lancie-login-check user="{{user}}" data-route="rfid" data-path="src/lancie-rfid/lancie-rfid.html">
        <lancie-rfid route="{{page.page}}" user="{{user}}"></lancie-rfid>
      </lancie-login-check>

      <lancie-ticket-profile-intercept
          data-route="tickets-intercept" data-path="src/lancie-ticket-page/lancie-ticket-profile-intercept.html"
          route="{{page.page}}" user="{{user}}"></lancie-ticket-profile-intercept>

      <lancie-register-confirmation data-route="confirmRegistration" data-path="src/lancie-login/lancie-register-confirmation.html"></lancie-register-confirmation>

      <lancie-check-email data-route="check-email" data-path="src/lancie-login/lancie-check-email.html"></lancie-check-email>

      <lancie-order-check data-route="ordersuccess" data-path="src/lancie-order-check.html"></lancie-order-check>

      <lancie-404 data-route="404" data-path="src/lancie-404.html"></lancie-404>

      <lancie-password-reset data-route="resetPassword" data-path="src/lancie-password/lancie-password-reset.html"></lancie-password-reset>

      <lancie-password-reset-success data-route="password-reset-success" data-path="src/lancie-password/lancie-password-reset-success.html"></lancie-password-reset-success>

      <lancie-request-password-reset data-route="request-password-reset" data-path="src/lancie-password/lancie-request-password-reset.html"></lancie-request-password-reset>

      <lancie-request-password-reset-success data-route="request-password-reset-success" data-path="src/lancie-password/lancie-request-password-reset-success.html"></lancie-request-password-reset-success>

      <lancie-contact data-route="contact" data-path="src/lancie-contact/lancie-contact.html"></lancie-contact>

      <lancie-contact-success data-route="contact-success" data-path="src/lancie-contact/lancie-contact-success.html"></lancie-contact-success>

    </iron-lazy-pages>
  </template>
  <script>
  'use strict';
    Polymer({
      is: 'lancie-content',
      properties: {
        route: {
          type: String,
          notify: true
        },
        user: {
          type: Object
        }
      },
      storeUser: function(event, request) {
        this.user = (request.response.message === 'Not logged in') ? '' : request.response;
        this.$.ajax.injectToken(request.xhr.getResponseHeader('X-CSRF-TOKEN'));
      },

      _matches: function(path, route) {
        return path === route;
      }
    });
  </script>
</dom-module>
