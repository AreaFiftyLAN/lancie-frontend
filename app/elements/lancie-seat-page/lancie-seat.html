<dom-module id="lancie-seat">
  <template>
    <style>
      :host {
        display: inline-block;
        background-color: green;
      }

      :host[taken] {
        background-color: red;
      }

      :host[selected] {
        background-color: blue;
      }

      paper-button {
        border: 1px black solid;
        display: inline-block;
        width: 100%;
        cursor: pointer;
        margin: 0;
        padding: 0;
        min-width: 0;
      }
    </style>
    <paper-button data-dialog="seatTicketPopup" on-tap="selectSeatTicket" number="{{index}}" group="{{group}}">{{index}}</paper-button>
    <template is="dom-if" if="{{taken}}">
      <paper-tooltip position="{{position}}">{{user.profile.displayName}}</paper-tooltip>
    </template>
  </template>
  <script>
    'use strict';
    Polymer({
      is: 'lancie-seat',
      properties: {
        taken: {
          type: Boolean,
          reflectToAttribute: true
        },
        user: {
          type: Object
        },
        index: {
          type: Number
        },
        position: {
          type: String
        },
        selected: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }
      },

      toggle: function() {
        if (this.taken) {
          return;
        }

        this.selected = !this.selected;
      },

      selectSeatTicket: function(e) {
        var selected = this.selected;
        if (prevSeat != null) {
          prevSeat.selected = false;
        }
        prevSeat = this;
        this.selected = !selected;
        if (!selected) {
          var button = e.target;
          while (!button.hasAttribute('data-dialog') && button !== document.body) {
            button = button.parentElement;
          }
          if (!button.hasAttribute('data-dialog')) {
            return;
          }
          var id = button.getAttribute('data-dialog');
          var dialog = document.getElementById(id);
          if (dialog) {
            dialog.open();
          }
        }
      }
    });
  </script>
</dom-module>
