<!--
@license
Copyright (c) 2015 The LANcie commission of W.I.S.V `Christiaan Huygens`. All rights reserved.
This code may only be used under the BSD style license found at https://github.com/WISVCH/LANcie/blob/master/LICENSE
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">


<dom-module id="lancie-rfid">
  <template>
    <style include="iron-flex iron-flex-alignment"></style>
    <style>
      :host {
        display: block;
      }

      paper-tabs {
        --paper-tabs: {
          background: #1a2b43;
          color: #ffe574;
        };
      }

      .card-content {
        background: #eeeeee;
      }
    </style>


    <lancie-ajax auto refurl="tickets" on-response="onLoadTickets"></lancie-ajax>

    <div class="layout vertical">
      <paper-card image="" elevation="1" animated-shadow="false">
        <div class="card-header">
          <paper-tabs selected="{{selected}}">
            <paper-tab>Registration</paper-tab>
            <paper-tab>Diner</paper-tab>
            <paper-tab>Bar :D</paper-tab>
          </paper-tabs>
        </div>
        <div class="card-content">
          <iron-pages selected="{{selected}}">
            <div>
              <label for="selectUser">Select user:</label>
              <input id="selectUser" value="{{searchString::input}}">
              <template is="dom-repeat" items="{{tickets}}" as="ticket"
                        filter="{{computeFilter(searchString)}}">
                <div>{{ticket.owner.profile.firstName}} {{ticket.owner.profile.lastName}}</div>
              </template>
            </div>
            <div>Diner</div>
            <div>Bar :D</div>
          </iron-pages>
        </div>
      </paper-card>
    </div>
  </template>

  <script>
    Polymer({
      is: 'lancie-rfid',
      properties: {
        user: Object,
        route: {
          type: String,
          notify: true,
          observer: '_changedRoute'
        },
        selected: {
          type: Number,
          value: 0
        },
        tickets: {
          type: Object,
          value: function() {
            return [];
          }
        }
      },
      computeFilter: function(string) {
        if (!string) {
          // set filter to null to disable filtering
          return null;
        } else {
          // return a filter function for the current search string
          string = string.toLowerCase();
          return function(ticket) {
            var firstName = ticket.owner.profile.firstName.toLowerCase();
            var lastName = ticket.owner.profile.lastName.toLowerCase();
            return (firstName.indexOf(string) != -1 ||
            lastName.indexOf(string) != -1);
          };
        }
      },
      onLoadTickets: function(event, request) {
        if (request.succeeded) {
          this.tickets = request.response;
        } else {
          console.log("Unable to connect.");
        }
      }
    });
  </script>
</dom-module>
